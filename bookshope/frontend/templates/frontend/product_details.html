{% extends "base/index.html" %}
{% block linkcss %}<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />{% endblock linkcss %}
{% block content %}

    <title>Premium Wireless Headphones - Product Details</title>

    <style>
    </style>
</head>
<body>
    <div class="container">
        

        <!-- Product Container -->
        <div class="product-container">
            <!-- Image Gallery -->
            <div class="image-gallery">
                <img src="{{product.product_image.url}}" alt="Premium Wireless Headphones" class="main-image" id="mainImage">
                {% comment %} <div class="thumbnail-container">
                    <img src="https://picsum.photos/seed/picsum/200/300" alt="Headphones view 1" class="thumbnail active" data-src="https://picsum.photos/seed/picsum/200/300">
                    <img src="https://picsum.photos/seed/picsum/200/300" alt="Headphones view 2" class="thumbnail" data-src="https://picsum.photos/seed/picsum/200/300">
                    <img src="https://picsum.photos/seed/picsum/200/300" alt="Headphones view 3" class="thumbnail" data-src="https://picsum.photos/seed/picsum/200/300">
                    <img src="https://picsum.photos/seed/picsum/200/300" alt="Headphones view 4" class="thumbnail" data-src="https://picsum.photos/seed/picsum/200/300">
                </div> {% endcomment %}
            </div>

            <!-- Product Info -->
            <form action="" method="post">
                {% csrf_token %}
                <div class="product-info">
                    {% comment %} <span class="product-badge">Best Seller</span> {% endcomment %}
                    <h1 class="product-title">{{product.product_name}}</h1>
                    <div class="product-rating">
                        
                        <span class="rating-text"> By <a href="{% url "author_details" author_slug=product.author.author_slug %}">
                             {{product.author.author_name}}
                        </a> reviews</span>
                    </div>
                    <div class="product-rating">
                        
                        <span class="rating-text"> â€¢ {{product.total_views}} reviews</span>
                    </div>

                    <div class="price-container">
                        <span class="current-price" id="currentPrice"></span>
                        <span class="original-price" id="originalPrice" data-price="{{product.price}}">{{product.price}}</span>
                        <span class="discount" id="discountPercent" data-discount="{{product.discount_percentage}}">{{product.discount_percentage}}% OFF</span>
                    </div>

                    <p class="product-description">
                        {{product.description}}
                    </p>

                    <div class="options-container">
                        <div class="option-group">
                            <label class="option-label">Stock</label>
                            <div class="option-buttons">
                                <span class="option-label discount stock" id='stock' data-option="storage" data-value="premium">{{product.stock}}</span>
                            </div>
                        </div>

                        

                        <div class="add-cart-box">
                            <div class="product-qty-box quantity-container">
                                <label class="option-label">Quantity</label>
                                <div class="quantity-selector">
                                    <button type="button" id="decrement" class="decrement quantity-btn"><span> - </span></button>
                                    <input type="number" id="cart_qty" 
                                    name="quantity"
                                    class="cart_qty cart_qty__{{ product.id }} quantity-input" 
                                    min="1" max="50" data-product-id="{{ product.id }}" 
                                    value="{{ product.product_cart.quantity|default:'1' }}">

                                    <button type="button" id="increment" class="increment quantity-btn"><span> + </span></button>
                                </div>
                            </div>
                            <div class="product-addtocart-box action-buttons">
                                <button type="submit" id="add_to_cart" class="add_to_cart btn btn-primary" data-product-id="{{ product.id }}">Add to Cart</button>    
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Reviews Section -->
         <!-- Review Form -->
        {% comment %} {% if user.is_authenticated %}
            <div class="review-form" style="margin-top:20px;">
                <h3>Write a Review</h3>
                <form method="post">
                    {% csrf_token %}

                    <!-- Comment -->
                    <label for="comment">Comment:</label><br>
                    <textarea name="comment" id="comment" rows="4" cols="50" 
                            placeholder="Write your experience..." required></textarea>
                    <br><br>

                    <!-- Submit Button -->
                    <button type="submit" 
                            style="background:#007bff; color:white; padding:8px 15px; border:none; border-radius:5px;">
                        Submit Review
                    </button>
                </form>
            </div>
        {% else %}
            <p><a href="{% url 'login' %}">Login</a> to write a review.</p>
        {% endif %} {% endcomment %}

    <section class="reviews-section" id="reviews">
        <div class="container">
            <!-- Authenticated User Review Form -->
            <div class="review-form-container" id="authenticatedReview">
                <div class="review-form-card">
                    <div class="review-form-header">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="header-text">
                            <h3>Write a Review</h3>
                            <p>Share your thoughts about this book</p>
                        </div>
                    </div>
                    
                    <form class="review-form" method="post" id="reviewForm" action="{% url 'user_review' product_slug=product.product_slug %}">
                       {% csrf_token %}
                        <!-- Comment Section -->
                        <div class="form-group">
                            <label for="comment" class="form-label">
                                Your Review <span class="required">*</span>
                            </label>
                            <div class="textarea-container">
                                <textarea 
                                    name="review" 
                                    id="comment" 
                                    rows="6" 
                                    placeholder="Share your experience with this book. What did you love about it? Would you recommend it to others?"
                                    required
                                    maxlength="500"
                                ></textarea>
                                <div class="char-count">
                                    <span id="charCount">0</span>/500
                                </div>
                            </div>
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="form-actions">
                            <button type="submit" class="btn-submit" id="submitReview">
                                <i class="fas fa-paper-plane"></i>
                                Submit Review
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>


        {% if reviews %}
            <div class="reviews-section">
                <h2 class="section-title">Customer Reviews</h2>
                
                {% for review in reviews %}
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-avatar"> {{ review.user.name|slice:":1"|upper|default:"U" }}</div>
                        <div class="reviewer-info">
                            <h4>{{review.user.name|capfirst}}</h4>
                            <p>{{review.review}}</p>
                            <span class="review-date">{{review.created_at|date:"M d, Y" }}</span>
                        </div>
                    </div>
                    
                </div>
                
                {% endfor %}
                
            </div> 
        {% endif %}
  

    <!-- Zoom Overlay -->
    {% comment %} <div class="zoom-overlay" id="zoomOverlay">
        <img src="/placeholder.svg" alt="Zoomed product image" class="zoom-image" id="zoomImage">
    </div> {% endcomment %}

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Added to cart successfully!</span>
    </div>

{% endblock content %}